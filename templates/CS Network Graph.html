<!DOCTYPE html>
<html>

<head>
	<title>CS Network Graph</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="utf-8">
	<meta name="keywords" content="" />
	<script type="application/x-javascript">
		addEventListener("load", function () {
			setTimeout(hideURLbar, 0);
		}, false);
		function hideURLbar() {
			window.scrollTo(0, 1);
		}
	</script>
	<script type="text/javascript" src="js/d3/d3.v4.js"></script>
	<script type="text/javascript" src="js/jquery/jquery-1.9.1.js"></script>
	<link rel="stylesheet" href="css/csnetwork.css" />
	<link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="css/bootstrap.css" rel='stylesheet' type='text/css' />
	<link href="css/style.css" rel='stylesheet' type='text/css' />
	<link href="css/about.css" rel='stylesheet' type='text/css' />
	<link rel="stylesheet" type="text/css" href="css/easy-responsive-tabs.css" />
	<link rel="stylesheet" href="css/team.css" type="text/css" media="all" />
	<link href="css/font-awesome.css" rel="stylesheet">
	<link href="http://fonts.googleapis.com/css?family=Merriweather+Sans:300,300i,400,400i,700,700i,800"
		rel="stylesheet">
	<link href="http://fonts.googleapis.com/css?family=Mallanna" rel="stylesheet">
</head>
<style>
	.cols {
		background: #FAFAFA;
		border-right: 1px solid #E0E0E0;
		width: 300px;
		height: 700px;
		position: relative;
	}

	.col {
		width: 200px;
		height: 700px;
		position: relative;
	}

	.container {
		/* width: 1200px;
		display: flex; */
		margin: 0;
		/* 取消容器的 margin */
	}

	.row {
		/* display: flex;
		justify-content: center;
		align-items: center; */
		gap: 0;
		/* 取消间隙 */
	}
</style>

<body>
	<div class="header inner_banner" id="home">
		<!--/top-bar-->
		<div class="top-bar">
			<div class="header-nav-agileits">
				<nav class="navbar navbar-default">
					<!-- Brand and toggle get grouped for better mobile display -->
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
							data-target="#bs-example-navbar-collapse-1">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<h1><a class="navbar-brand" href="Home.html">CS Network</a></h1>
					</div>
					<!-- Collect the nav links, forms, and other content for toggling -->
					<div class="collapse navbar-collapse nav-wil" id="bs-example-navbar-collapse-1">
						<nav>
							<ul class="top_nav">
								<li><a href="Home.html" class="active">Home</a></li>
								<li><a href="CS Network Graph.html">CS Network Graph</a></li>
								<li class="dropdown">
									<a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="Pages"
										role="button" aria-haspopup="true" aria-expanded="false">Distribution<span
											class="fa fa-angle-down"></span></a>
									<ul class="dropdown-menu">
										<li><a href="World.html">World</a></li>
										<li><a href="China.html">China</a></li>
									</ul>
								</li>
								<li><a href="Filter.html">Filter</a></li>
								<li><a href="Paper Recommendation.html">Paper Recommendation</a></li>
							</ul>
						</nav>
					</div>
				</nav>

			</div>
		</div>
		<!--//top-bar-->
		<!--/ banner-text -->
		<!--// banner-text -->
	</div>
	<!--//inner_banner-->
	<!--/short-->
	<div class="services-breadcrumb-w3ls-agile">
		<div class="inner_breadcrumb">
			<ul class="short">
				<li><a href="Home.html">Home</a><span>|</span></li>
				<li>CS Network Graph</li>
			</ul>
		</div>
	</div>
	<!--//short-->
	<!-- //inner_content -->
	<div class="container" style="width: 1200px">
		<div class="row" style="width: 1200px;display: flex;">
			<div class="cols">
				<div class="search-box">
					<input type="text" id="searchBox" class="search-txt" placeholder="name?" />
					<a class="search-btn">
						<i class="fa fa-search" aria-hidden="true"></i>
					</a>
				</div>
			</div>
			<div class="col">
				<div id="graphics" style="height: 720px"></div>
			</div>
		</div>

	</div>


	<!--footer-->
	<div class="contact-footer-w3layouts-agile">
		<div class="bottom-social-agileits-w3ls">
			<div class="container">
				<div class="col-md-8 botttom-nav-w3ls-agileits">
					<ul class="f_links col-md-4">
						<li>
							<a href="Home.html">Home</a>
						</li>
						<li>
							<a href="CS Network Graph.html">CS Network Graph</a>
						</li>
						<li>
							<a href="World.html">World</a>
						</li>
						<li>
							<a href="China.html">China</a>
						</li>
						<li>
							<a href="Filter.html">Filter</a>
						</li>
					</ul>
					<ul class="f_links col-md-4">
						<li>
							<a href="index.html">Topics</a>
						</li>
						<li>
							<a href="404.html">Blog</a>
						</li>
						<li>
							<a href="404.html">Careers</a>
						</li>
						<li>
							<a href="services.html">Services</a>
						</li>

					</ul>
					<ul class="f_links thrd col-md-4">
						<li>
							<a href="index.html">Topics</a>
						</li>
						<li>
							<a href="404.html">Events</a>
						</li>
						<li>
							<a href="app.html">Mobile App</a>
						</li>


					</ul>
					<div class="clearfix"></div>
				</div>
				<div class="col-md-4 social-icons-wthree">
					<h6>Connect with us</h6>
					<a class="facebook" href="#"><span class="fa fa-facebook"></span></a>
					<a class="twitter" href="#"><span class="fa fa-twitter"></span></a>
					<a class="pinterest" href="#"><span class="fa fa-pinterest-p"></span></a>
					<a class="linkedin" href="#"><span class="fa fa-linkedin"></span></a>
				</div>
				<div class="clearfix"></div>

			</div>
		</div>
		<div class="copy-w3-agileits">
			<h2 class="footer-logo"><a href="Home.html">CS Network</a></h2>
			<p>Copyright &copy; 2018.Company name All rights reserved.</p>
			<div class="clearfix"></div>
		</div>
	</div>
	<!--/footer -->

	<!-- js -->
	<script type="text/javascript" src="js/jquery-2.2.3.min.js"></script>
	<!-- //js -->
	<!--search-bar-->
	<script src="js/main.js"></script>
	<!--gallery -->
	<script src="js/jquery.chocolat.js"></script>
	<!--light-box-files -->
	<script type="text/javascript">
		$(function () {
			$('.gallery-grid1 a').Chocolat();
		});
	</script>
	<!-- //gallery -->
	<script src="js/responsiveslides.min.js"></script>
	<script>
		$(function () {
			$("#slider4").responsiveSlides({
				auto: true,
				pager: true,
				nav: true,
				speed: 1000,
				namespace: "callbacks",
				before: function () {
					$('.events').append("<li>before event fired.</li>");
				},
				after: function () {
					$('.events').append("<li>after event fired.</li>");
				}
			});
		});
	</script>
	<!--//search-bar-->

	<script src="js/easyResponsiveTabs.js"></script>
	<!--Plug-in Initialisation-->
	<script type="text/javascript">
		$(document).ready(function () {
			//Vertical Tab
			$('#parentVerticalTab').easyResponsiveTabs({
				type: 'vertical', //Types: default, vertical, accordion
				width: 'auto', //auto or any width like 600px
				fit: true, // 100% fit in a container
				closed: 'accordion', // Start closed if in accordion view
				tabidentify: 'hor_1', // The tab groups identifier
				activate: function (event) { // Callback function if tab is switched
					var $tab = $(this);
					var $info = $('#nested-tabInfo2');
					var $name = $('span', $info);
					$name.text($tab.text());
					$info.show();
				}
			});
		});
	</script>
	<!--/script-->
	<!-- stats -->
	<script src="js/jquery.waypoints.min.js"></script>
	<script src="js/jquery.countup.js"></script>
	<script>
		$('.counter').countUp();
	</script>
	<!-- //stats -->
	<!-- start-smoth-scrolling -->
	<script type="text/javascript" src="js/move-top.js"></script>
	<script type="text/javascript" src="js/easing.js"></script>
	<script type="text/javascript">
		jQuery(document).ready(function ($) {
			$(".scroll").click(function (event) {
				event.preventDefault();
				$('html,body').animate({
					scrollTop: $(this.hash).offset().top
				}, 900);
			});
		});
	</script>
	<!-- start-smoth-scrolling -->

	<script type="text/javascript">
		$(document).ready(function () {
			/*
									var defaults = {
											containerID: 'toTop', // fading element id
										containerHoverID: 'toTopHover', // fading element hover id
										scrollSpeed: 1200,
										easingType: 'linear' 
										};
									*/

			$().UItoTop({
				easingType: 'easeOutQuart'
			});

		});
	</script>
	<a href="#" id="toTop" style="display: block;"> <span id="toTopHover" style="opacity: 1;"> </span></a>
	<script type="text/javascript" src="js/bootstrap-3.1.1.min.js"></script>

	<script type="text/javascript">
		d3.json("./data/scientists.json", function (json) {
			// 创建
			function GroupExplorer(wrapper, config) {
				// 默认配置对象
				var defaultConfig = {
					data: { "nodes": [], "links": [] },
					// 初始宽高为视口宽高
					width: window.innerWidth,
					height: window.innerHeight,
					// 节点之间的距离，初始值为100
					distance: 100
				};
				// jQuery库中的 ​$.extend()​方法，获取数据值
				$.extend(true, defaultConfig, config);
				console.log(defaultConfig);
				// link里不是用名字匹配而是用数字（也就是对应对象的索引，即节点数组的顺序）
				// 检查是否存在名字，进行索引转换
				defaultConfig.data.links.forEach(function (e) {
					if (typeof e.source != "number" && typeof e.target != "number") {
						var sourceNode = defaultConfig.data.nodes.filter(function (n) {
							return n.name === e.source;
						})[0],
							targetNode = defaultConfig.data.nodes.filter(function (n) {
								return n.name === e.target;
							})[0];
						e.source = sourceNode;
						e.target = targetNode;
					}
				});

				//d3画图start，首先初始化
				var _this = this, highlighted = null, dependsNode = [], dependsLinkAndText = [];

				// 将缩放变换应用到容器元素
				this.zoomed = function () {
					_this.vis.attr("transform", d3.event.transform);
				};
				// 设置缩放范围和缩放响应函数。
				var zoom = d3.zoom()
					.scaleExtent([0.2, 10])
					.on("zoom", function () {
						_this.zoomed();
					});

				// 选择body元素，并创建一个SVG画布，并应用缩放功能
				this.vis = d3.select("#graphics").append("svg:svg")
					.attr("width", "1320px")
					.attr("height", "700px")
					// 实现双击还原
					.call(zoom).on("dblclick.zoom", null);
				// 分组元素，用于放置所有的节点、连接线和文字
				this.vis = this.vis.append('g').attr('class', 'all')
					.attr("width", defaultConfig.width)
					.attr("height", defaultConfig.height);

				// 创建力导向布局和力模型
				this.force = d3.forceSimulation()
					// 指定节点
					.nodes(defaultConfig.data.nodes)
					// 将连接线的力指定为 ​"link"​ 类型的力
					.force("link", d3.forceLink(defaultConfig.data.links).distance(defaultConfig.distance))
					// 将节点之间的斥力指定为 ​"charge"​ 类型的力，创建一个斥力模型，用于模拟节点之间的互斥效应。
					.force("charge", d3.forceManyBody())
					// 将可视化的中心点设置为 ​(defaultConfig.width / 2, defaultConfig.height / 2)​。
					.force("center", d3.forceCenter(defaultConfig.width / 2, defaultConfig.height / 2))
					// 将碰撞力指定为 ​"collide"​ 类型的力。
					// 使节点保持至少 ​60​ 个单位的距离
					// 设置碰撞的强度为 0.2，使节点之间有一定的距离。​
					// .iterations(5)​ 设置迭代次数为 5，提高碰撞的精确度。
					.force("collide", d3.forceCollide(60).strength(0.2).iterations(5));

				// 创建箭头​<marker>​元素，之后可以使用该箭头标记在连接线的末端添加箭头效果。
				this.vis.append("svg:defs").selectAll("marker")
					// 绑定一个数据数组    
					.data(["end"])
					// 创建一个 ​<marker>​ 元素
					.enter().append("svg:marker")
					// 设置一个唯一的 ​id​ 属性
					.attr("id", "arrow")
					// 类名为 ​'arrow'​，用于后续的CSS样式定义
					.attr('class', 'arrow')
					// 指定视图框(viewBox)，定义了在通过视图呈现时，元素起始点和围绕元素的盒子的属性
					.attr("viewBox", "0 -5 10 10")
					// 在X轴、Y轴方向上的参考点
					.attr("refX", 27)
					.attr("refY", 0)
					// 宽高
					.attr("markerWidth", 9)
					.attr("markerHeight", 16)
					.attr("markerUnits", "userSpaceOnUse")
					.attr("orient", "auto")
					// 添加一个 ​<path>​ 元素，用于绘制箭头的路径
					.append("svg:path")
					// 设置路径命令
					.attr("d", "M0,-5L10,0L0,5")
					.attr('fill', '#666');

				// 绘制连接线（link）并添加箭头标记
				this.link = this.vis.selectAll("line.link")
					.data(defaultConfig.data.links)
					.enter().append("svg:line")
					.attr("class", "link")
					// 连接线的宽度为 1 像素
					.attr('stroke-width', 1)
					// 获取起始点、目标点x,y
					.attr("x1", function (d) { return d.source.x; })
					.attr("y1", function (d) { return d.source.y; })
					.attr("x2", function (d) { return d.target.x; })
					.attr("y2", function (d) { return d.target.y; })
					// 添加箭头标记
					// .attr("marker-end","url(#arrow)")
					.attr('stroke', '#999');

				// 重新计算力导向布局，并刷新可视化效果
				this.tick = function () {
					// 更新连接线的起始点 (x1, y1) 和终点 (x2, y2) 的位置
					_this.link.attr("x1", function (d) { return d.source.x; })
						.attr("y1", function (d) { return d.source.y; })
						.attr("x2", function (d) { return d.target.x; })
						.attr("y2", function (d) { return d.target.y; });
					_this.linetext.attr("x", function (d) { return (d.source.x + d.target.x) / 2; })
						.attr("y", function (d) { return (d.source.y + d.target.y) / 2; });
					// 更新节点的位置
					_this.node.attr("transform", function (d) { return "translate(" + d.x + "," + d.y + ")"; });
				};
				_this.force.on("tick", this.tick);

				// 处理节点的拖拽事件，并创建了一个用于节点拖拽的drag行为
				var dragstart = function (d, i) {
					console.info(d3.event.subject);
					_this.force.stop();
					// 阻止事件传播，以防止与其他事件冲突
					d3.event.sourceEvent.stopPropagation();
				};
				var dragmove = function (d, i) {
					d.px += d3.event.dx;
					d.py += d3.event.dy;
					d.x += d3.event.dx;
					d.y += d3.event.dy;
					// 重新计算力导向布局，并刷新可视化效果
					_this.tick();
				};
				var dragend = function (d, i) {
					d3.event.subject.fx = null;
					d3.event.subject.fy = null;
					// 重新启动力导向布局的运行
					_this.force.restart();
					_this.tick();
				};
				this.nodeDrag = d3.drag()
					.on("start", dragstart)
					.on("drag", dragmove)
					.on("end", dragend);


				// 高亮显示与指定对象相关的节点、连接线和文本，并取消其他元素的高亮显示
				this.highlightObject = function (obj) {
					if (obj) {
						// 获取要高亮显示的对象的索引
						var objIndex = obj.index;
						// 添加到依赖节点数组
						dependsNode = dependsNode.concat([objIndex]);
						// 添加到依赖连接线和文本数组
						dependsLinkAndText = dependsLinkAndText.concat([objIndex]);

						// 遍历连接线数据，确定与指定对象相关的节点索引，并添加到依赖节点数组中
						defaultConfig.data.links.forEach(function (lkItem) {
							if (objIndex == lkItem['source']['index']) {
								dependsNode = dependsNode.concat([lkItem.target.index]);
							} else if (objIndex == lkItem['target']['index']) {
								dependsNode = dependsNode.concat([lkItem.source.index]);
							}
						});

						// 根据依赖节点数组设置节点样式为 "inactive"
						_this.node.classed('inactive', function (d) {
							return dependsNode.indexOf(d.index) == -1;
						});

						// 根据依赖连接线和文本数组设置连接线样式为 "inactive"
						_this.link.classed('inactive', function (d) {
							return dependsLinkAndText.indexOf(d.source.index) == -1 && dependsLinkAndText.indexOf(d.target.index) == -1;
						});

						// 根据依赖连接线和文本数组设置连线上的文本样式为 "inactive"
						_this.linetext.classed('inactive', function (d) {
							return dependsLinkAndText.indexOf(d.source.index) == -1 && dependsLinkAndText.indexOf(d.target.index) == -1;
						});
					} else {
						// 如果未指定对象，则取消所有元素的高亮显示，将样式类 "inactive" 移除
						_this.node.classed('inactive', false);
						_this.link.classed('inactive', false);
						_this.linetext.classed('inactive', false);
					}
				};

				// 搜索框搜索
				var searchBox = document.getElementById('searchBox');
				searchBox.addEventListener('input', function () {
					var searchName = this.value.trim();
					if (searchName !== '') {
						// 每次搜索之前先还原
						dependsNode = dependsLinkAndText = [];
						_this.highlightObject(null);
						// 节点姓名匹配
						var matchedNode = defaultConfig.data.nodes.find(function (node) {
							return node.name.toLowerCase() === searchName.toLowerCase();
						});
						_this.highlightObject(matchedNode);
					} else {
						_this.highlightObject(null);
					}
				});
				// 悬停框显示
				this.highlightToolTip = function (obj) {
					if (obj) {
						_this.tooltip.html("<div class='title'>" + obj.name + "的详情</div>" +
							"<table class='detail-info'><tr><td class='td-label'>国家：</td><td>" + obj.country + "</td></tr>" +
							"<tr><td class='td-label'>学校：</td><td>" + obj.School + "</td></tr><tr><td class='td-label'>研究领域：</td><td>" + obj.Famous + "</td></tr>" +
							"<tr><td class='td-label'>链接：</td><td><a href='" + obj.link + "'>" + obj.name + "的主页</a></td></tr></table>")
							.style("left", (d3.event.pageX-280) + "px")
							.style("top", (d3.event.pageY-200) + "px")
							.style("opacity", 1.0);
					} else {
						_this.tooltip.style("opacity", 0.0);
					}
				};
				this.tooltip = d3.select("#graphics").append("div")
					.attr("class", "tooltip")
					.attr("opacity", 0.0)
					.on('dblclick', function () {
						// 被双击时，阻止提示框冒泡，避免影响其他事件。
						d3.event.stopPropagation();
					})
					.on('mouseover', function () {
						// 悬停时，如果之前设置了鼠标移出的定时器，则清除该定时器，以防止工具提示在短时间内被误隐藏
						if (_this.node.mouseoutTimeout) {
							clearTimeout(_this.node.mouseoutTimeout);
							_this.node.mouseoutTimeout = null;
						}
					})
					.on('mouseout', function () {
						// 当鼠标移出工具提示时，如果之前设置了鼠标移出的定时器，则先清除该定时器。
						// 然后，设置一个新的定时器
						// 在快速移动鼠标时工具提示不会立即消失，只有在鼠标离开一段时间后才会隐藏。
						if (_this.node.mouseoutTimeout) {
							clearTimeout(_this.node.mouseoutTimeout);
							_this.node.mouseoutTimeout = null;
						}
						_this.node.mouseoutTimeout = setTimeout(function () {
							_this.highlightToolTip(null);
						}, 300);
					});

				// 创建节点元素，并绑定相关的数据和事件处理函数
				this.node = this.vis.selectAll("g.node")
					.data(defaultConfig.data.nodes)
					.enter().append("svg:g")
					.attr("class", "node")
					.call(_this.nodeDrag)
					.on('mouseover', function (d) {
						// 鼠标悬停在节点上时，清除之前设置的鼠标移出的定时器，显示相应的工具提示
						if (_this.node.mouseoutTimeout) {
							clearTimeout(_this.node.mouseoutTimeout);
							_this.node.mouseoutTimeout = null;
						}
						_this.highlightToolTip(d);
					})
					.on('mouseout', function () {
						// 鼠标移出节点时，清除之前设置的鼠标移出的定时器，并设置一个新的定时器，在一定时间后隐藏工具提示
						if (_this.node.mouseoutTimeout) {
							clearTimeout(_this.node.mouseoutTimeout);
							_this.node.mouseoutTimeout = null;
						}
						_this.node.mouseoutTimeout = setTimeout(function () {
							_this.highlightToolTip(null);
						}, 300);
					})
					.on('dblclick', function (d) {
						// 双击节点时，高亮显示与当前节点相关的节点、连接线和连线上的文本，阻止事件冒泡
						_this.highlightObject(d);
						d3.event.stopPropagation();
					});

				// 在整个页面上绑定双击事件处理函数
				d3.select("#graphics").on('dblclick', function () {
					// 当双击页面其他区域时，取消所有节点、连接线和连线上的文本的高亮显示，并重置依赖节点和连接线数组
					dependsNode = dependsLinkAndText = [];
					_this.highlightObject(null);
					// 同时清空输入框
					d3.selectAll("#searchBox").property("value", "");
				});

				// 为每个节点添加图片元素表示节点图标
				this.node.append("svg:image")
					.data(defaultConfig.data.nodes)
					.attr("class", "circle")
					.attr("xlink:href", function (d) { return (d.image); }) // 图片链接地址"images/" + 
					.attr("x", "-15px") // 图片相对于节点位置的水平偏移量
					.attr("y", "-15px") // 图片相对于节点位置的垂直偏移量
					.attr("width", "30px") // 图片的宽度
					.attr("height", "30px"); // 图片的高度

				// 为每个节点添加文本元素表示节点名称
				this.node.append("svg:text")
					.attr("class", "nodetext")
					.attr("dy", "30px") // 文本相对于节点位置的垂直偏移量
					.attr('text-anchor', 'middle') // 文本的水平对齐方式
					.text(function (d) { return d.name; }); // 设置文本内容为节点的名称

				// 为每条连线添加文本元素表示连线的关系描述
				this.linetext = this.vis.selectAll('.linetext')
					.data(defaultConfig.data.links)
					.enter()
					.append("text")
					.attr("class", "linetext")
					.attr("x", function (d) { return (d.source.x + d.target.x) / 2; }) // 文本的水平位置为连线起点和终点x坐标的中间值
					.attr("y", function (d) { return (d.source.y + d.target.y) / 2; }) // 文本的垂直位置为连线起点和终点y坐标的中间值
					// .text(function (d) { return d.value }) // 设置文本内容为连线的关系描述
					.call(d3.drag()); // 添加拖拽行为，使文本可以被拖动
			}
			// 实例应用
			new GroupExplorer('graphics', {
				data: json
			});
		});
	</script>
</body>

</html>